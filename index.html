<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Historischer WhatsApp-Chatbot</title>
<style>
body,html{height:100%;margin:0;font-family:sans-serif;background:#e5ddd5;}
.hidden{display:none;}
#start-screen,#chat-screen{height:100%;}
#start-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;}
#start-screen input{margin:5px;padding:10px;width:80%;}
#tiles{display:flex;flex-wrap:wrap;justify-content:center;}
.tile{width:100px;height:120px;border:1px solid #ccc;margin:5px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#fff;cursor:pointer;}
.tile img{width:60px;height:60px;border-radius:50%;object-fit:cover;margin-bottom:5px;}
#chat-screen{display:flex;flex-direction:column;}
header{background:#075E54;color:#fff;padding:10px;display:flex;align-items:center;}
header img{width:40px;height:40px;border-radius:50%;margin-right:10px;object-fit:cover;}
main{flex:1;overflow-y:auto;padding:10px;}
.bubble{max-width:80%;padding:8px;border-radius:5px;margin:5px;}
.user{background:#dcf8c6;margin-left:auto;}
.bot{background:#fff;margin-right:auto;}
footer{display:flex;align-items:center;padding:5px;background:#f0f0f0;}
footer button{background:none;border:none;font-size:1.4em;cursor:pointer;margin:0 5px;}
footer input{flex:1;padding:8px;border-radius:20px;border:1px solid #ccc;}
#emoji-bar{display:flex;justify-content:center;background:#f0f0f0;}
#emoji-bar button{background:none;border:none;font-size:1.2em;cursor:pointer;margin:5px;}
#teacher-panel{position:fixed;top:10px;right:10px;background:#fff;border:1px solid #ccc;padding:10px;}
</style>
</head>
<body>
<div id="start-screen">
  <input id="student-name" placeholder="Dein Name">
  <input id="student-class" placeholder="Deine Klasse">
  <input id="search" placeholder="Suche...">
  <div id="tiles"></div>
</div>

<div id="chat-screen" class="hidden">
  <header>
    <img id="avatar" src="">
    <div>
      <div id="chat-name"></div>
      <small id="status">online</small>
    </div>
  </header>
  <main id="chat"></main>
  <div id="emoji-bar">
    <button data-type="positiv">ğŸ‘</button>
    <button data-type="negativ">ğŸ‘</button>
    <button data-type="nachdenken">ğŸ¤”</button>
    <button data-type="krieg">âš”ï¸</button>
    <button data-type="wissenschaft">ğŸ”¬</button>
    <button data-type="religion">ğŸ™</button>
    <button data-type="sonst">â“</button>
  </div>
  <footer>
    <button id="pdf-export">ğŸ“„</button>
    <input id="message" placeholder="Nachricht">
    <button id="send">â¤</button>
  </footer>
</div>

<div id="teacher-panel" class="hidden">
  <label><input type="radio" name="mode" value="neutral" checked> neutral</label><br>
  <label><input type="radio" name="mode" value="historisch"> historisch gefÃ¤rbt</label><br>
  <label><input type="radio" name="mode" value="zitat"> Zitate + ErklÃ¤rung</label>
</div>

<script type="module">
const figures=[
 {name:"Albert Einstein",img:"https://upload.wikimedia.org/wikipedia/commons/d/d3/Albert_Einstein_Head.jpg"},
 {name:"Adolf Hitler",img:"https://upload.wikimedia.org/wikipedia/commons/9/9c/Hitler_portrait_crop.jpg"},
 {name:"Jesus",img:"https://upload.wikimedia.org/wikipedia/commons/8/88/Jesus_Pantocrator_icon.jpg"},
 {name:"Heinrich VIII.",img:"https://upload.wikimedia.org/wikipedia/commons/3/3a/HenryVIII.jpg"},
 {name:"PelÃ©",img:"https://upload.wikimedia.org/wikipedia/commons/8/89/Pele_conference.jpg"},
 {name:"Maradona",img:"https://upload.wikimedia.org/wikipedia/commons/4/4b/Diego_Maradona_2012.jpg"},
 {name:"Stalin",img:"https://upload.wikimedia.org/wikipedia/commons/4/45/Stalin_Full_Image.jpg"},
 {name:"Da Vinci",img:"https://upload.wikimedia.org/wikipedia/commons/e/e2/Leonardo_da_Vinci_-_presumed_self-portrait_-_WGA12798.jpg"},
 {name:"Curie",img:"https://upload.wikimedia.org/wikipedia/commons/6/69/Marie_Curie_c1920.jpg"},
 {name:"Napoleon",img:"https://upload.wikimedia.org/wikipedia/commons/5/50/Napoleon_Bonaparte.jpg"},
 {name:"Picasso",img:"https://upload.wikimedia.org/wikipedia/commons/9/99/Portrait_de_Picasso%2C_1908.jpg"},
 {name:"Elizabeth II.",img:"https://upload.wikimedia.org/wikipedia/commons/3/3d/Queen_Elizabeth_II_in_March_2015.jpg"}
];
const tileBox=document.getElementById('tiles');
figures.forEach(f=>{
 const div=document.createElement('div');
 div.className='tile';
 const img=document.createElement('img');
 img.src=f.img;
 img.alt=f.name;
 img.onerror=()=>{img.remove();div.prepend('ğŸ‘¤');};
 const span=document.createElement('span');
 span.textContent=f.name;
 div.appendChild(img);
 div.appendChild(span);
 div.onclick=()=>startChat(f);
 tileBox.appendChild(div);
});
document.getElementById('search').addEventListener('input',e=>{
 const t=e.target.value.toLowerCase();
 Array.from(tileBox.children).forEach(c=>{
  c.style.display=c.innerText.toLowerCase().includes(t)?'flex':'none';
 });
});
let currentFigure="";
function startChat(figure){
 document.getElementById('start-screen').classList.add('hidden');
 document.getElementById('chat-screen').classList.remove('hidden');
 document.getElementById('chat-name').textContent=figure.name;
 const header=document.querySelector('#chat-screen header');
 const av=document.getElementById('avatar');
 av.src=figure.img;
 av.onerror=()=>{av.remove();const sp=document.createElement('span');sp.textContent='ğŸ‘¤';header.prepend(sp);};
 currentFigure=figure.name;
 addBotMessage("Hallo, ich bin "+figure.name+". Frag mich etwas!");
}

const emoji={positiv:'ğŸ‘',negativ:'ğŸ‘',nachdenken:'ğŸ¤”',krieg:'âš”ï¸',wissenschaft:'ğŸ”¬',religion:'ğŸ™',sonst:'â“'};
document.querySelectorAll('#emoji-bar button').forEach(b=>{
 b.onclick=()=>addUserMessage(emoji[b.dataset.type]);
});

document.getElementById('send').onclick=sendMessage;
document.getElementById('message').addEventListener('keydown',e=>{
 if(e.key==='Enter') sendMessage();
});
document.addEventListener('keydown',e=>{
 if(e.ctrlKey && e.key.toLowerCase()==='l'){
  document.getElementById('teacher-panel').classList.toggle('hidden');
 }
});
let mode="neutral";
Array.from(document.getElementsByName('mode')).forEach(r=>r.onchange=e=>{mode=e.target.value;});
document.getElementById('pdf-export').onclick=exportPDF;

function addUserMessage(t){
 const div=document.createElement('div');
 div.className='bubble user';
 div.textContent=t;
 document.getElementById('chat').appendChild(div);
 scrollChat();
}
function addBotMessage(t){
 const div=document.createElement('div');
 div.className='bubble bot';
 div.textContent=t;
 document.getElementById('chat').appendChild(div);
 scrollChat();
}
function scrollChat(){
 const m=document.getElementById('chat');
 m.scrollTop=m.scrollHeight;
}

async function sendMessage(){
 const inp=document.getElementById('message');
 const text=inp.value.trim();
 if(!text) return;
 addUserMessage(text);
 inp.value="";
 const reply=await getAnswer(text);
 addBotMessage(reply);
}

async function getAnswer(q){
 try{
  const url='https://de.wikipedia.org/api/rest_v1/page/summary/'+encodeURIComponent(currentFigure);
  const res=await fetch(url);
  if(!res.ok) throw new Error('net');
  const data=await res.json();
  let txt=data.extract||'';
  if(!txt) return "Dazu kann ich dir leider nichts sagen.";
  let first=txt.split('. ')[0];
  first=first.replace(currentFigure,'Ich');
  if(mode==='historisch'){first='In meiner Zeit: '+first;}
  if(mode==='zitat'){
    const res2=await fetch('https://de.wikipedia.org/api/rest_v1/page/plain/'+encodeURIComponent(currentFigure));
    if(res2.ok){
      const t=await res2.text();
      const line=t.split('\n').find(s=>s.includes('â€'));
      if(line){
        const quote=line.split('â€')[1].split('â€œ')[0];
        return 'â€'+quote+'â€œ - '+first;
      }
    }
  }
  return first+'.';
 }catch(e){
  return "Dazu kann ich dir leider nichts sagen.";
 }
}

async function exportPDF(){
 try{
  const mod=await import('https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js');
  mod.default(document.getElementById('chat'));
 }catch(e){
  window.print();
 }
}
</script>
</body>
</html>
