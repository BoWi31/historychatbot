<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marie Curie – Chatbot</title>
  <style>
    body{margin:0;font-family:system-ui,Arial,sans-serif;background:#eae6df;display:flex;justify-content:center;align-items:center;height:100vh}
    .app{width:420px;max-width:100%;height:700px;display:flex;flex-direction:column;background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.1);overflow:hidden}
    .header{display:flex;align-items:center;gap:10px;padding:10px;background:#f0f2f5}
    .avatar{width:40px;height:40px;border-radius:50%;object-fit:cover}
    .name{font-weight:bold}
    .status{font-size:12px;color:#25d366}
    .chat{flex:1;overflow-y:auto;padding:10px;background:#eae6df}
    .bubble{max-width:75%;padding:8px 10px;border-radius:10px;margin:5px 0;line-height:1.4}
    .me{background:#d9fdd3;margin-left:auto}
    .bot{background:#fff;margin-right:auto}
    .meta{font-size:10px;color:#888;text-align:right}
    .composer{display:flex;padding:10px;background:#f0f2f5;gap:8px}
    .input{flex:1;padding:10px;border-radius:20px;border:1px solid #ccc}
    .send{width:40px;height:40px;border-radius:50%;background:#25d366;color:#fff;border:none;cursor:pointer}
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <img class="avatar" src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/Marie_Curie_c1920.png/256px-Marie_Curie_c1920.png" alt="Marie Curie">
      <div>
        <div class="name">Marie Curie</div>
        <div class="status" id="status">online</div>
      </div>
    </div>
    <div id="chat" class="chat"></div>
    <div class="composer">
      <input id="input" class="input" placeholder="Nachricht" />
      <button id="send" class="send">➤</button>
    </div>
  </div>

  <script>
  // Clean script block replacing broken code
  (function(){
    var chatEl=document.getElementById('chat');
    var inputEl=document.getElementById('input');
    var sendBtn=document.getElementById('send');
    var statusEl=document.getElementById('status');
    var personNameEl=document.getElementById('personName');

    var PERSON={ name:'Marie Curie', titles:{ de:'Marie Curie', en:'Marie Curie', fr:'Marie Curie', pl:'Maria Skłodowska-Curie', ru:'Мария Склодовская-Кюри', ar:'ماري كوري', tr:'Marie Curie', ku:'Marie Curie' } };

    function timeNow(){ var d=new Date(); return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }
    function addBubble(text, who){ var div=document.createElement('div'); div.className='bubble '+(who==='me'?'me':'bot'); div.textContent=text; var meta=document.createElement('div'); meta.className='meta'; meta.textContent=timeNow(); div.appendChild(meta); chatEl.appendChild(div); chatEl.scrollTop=chatEl.scrollHeight; return div; }

    function detectLang(text){ var t=(text||'').toLowerCase(); var score={de:0,en:0,fr:0,pl:0,ru:0,ar:0,tr:0,ku:0};
      function bump(arr,k){ for(var i=0;i<arr.length;i++){ if(t.indexOf(arr[i])>-1) score[k]++; } }
      bump(['wer','wann','wo','warum','wie','erkläre','geburt','geboren','nobel','forschung'],'de');
      bump(['who','when','where','why','how','explain','born','birth','nobel','research'],'en');
      bump(['qui','quand','où','pourquoi','comment','née','naissance'],'fr');
      bump(['kto','kiedy','gdzie','dlaczego','jak','urodzona','urodził','urodziła'],'pl');
      bump(['кто','когда','где','почему','как','родил','родилась'],'ru');
      bump(['من','متى','أين','لماذا','كيف','ولدت'],'ar');
      bump(['kim','ne zaman','nerede','neden','nasıl','doğdu'],'tr');
      bump(['kî','kengî','li ku','çima','çawa','jidayikbû'],'ku');
      for(var i=0;i<t.length;i++){ var c=t.charCodeAt(i); if(c>=1024&&c<=1279) score.ru+=2; if(c>=1536&&c<=1791) score.ar+=2; }
      var arr=Object.entries(score).sort(function(a,b){ return b[1]-a[1]; });
      return arr[0][1]>0 ? arr[0][0] : 'de';
    }
    function langHost(lang){ var map={de:'de',en:'en',fr:'fr',pl:'pl',ru:'ru',ar:'ar',tr:'tr',ku:'ku'}; return (map[lang]||'de')+'.wikipedia.org'; }
    function getTitleByLang(lang){ var t=PERSON.titles||{}; return t[lang]||PERSON.name; }

    async function fetchShortBio(lang){
      var host=langHost(lang); var title=encodeURIComponent(getTitleByLang(lang));
      var url='https://'+host+'/w/api.php?action=query&prop=extracts&explaintext=1&exsentences=3&titles='+title+'&format=json&origin=*';
      var r=await fetch(url); if(!r.ok) throw new Error('HTTP '+r.status); var j=await r.json(); var page=Object.values(j.query.pages)[0]; return page.extract||'';
    }
    async function fetchMoreBio(lang, n){
      var host=langHost(lang); var title=encodeURIComponent(getTitleByLang(lang));
      var url='https://'+host+'/w/api.php?action=query&prop=extracts&explaintext=1&exsentences='+(n||12)+'&titles='+title+'&format=json&origin=*';
      var r=await fetch(url); if(!r.ok) throw new Error('HTTP '+r.status); var j=await r.json(); var page=Object.values(j.query.pages)[0]; return page.extract||'';
    }

    function splitSentences(text){ var out=[], cur=''; var enders=['.','!','?','؟']; var s=text||''; for(var i=0;i<s.length;i++){ var ch=s[i]; cur+=ch; if(enders.indexOf(ch)>-1){ if(cur.trim()) out.push(cur.trim()); cur=''; } } if(cur.trim()) out.push(cur.trim()); return out; }
    function simplify(text){ var s=text||''; var out='', prev=false; for(var i=0;i<s.length;i++){ var code=s.charCodeAt(i); var ws=(code===32||code===9||code===10||code===13); if(ws){ if(!prev){ out+=' '; prev=true; } } else { out+=s[i]; prev=false; } } return out.trim(); }

    function toFirstPersonBirth(extract, lang){ var x=simplify(extract); var starIdx=x.indexOf('(*'); if(starIdx>-1){ var close=x.indexOf(')', starIdx+2); if(close>-1){ var chunk=x.slice(starIdx+2, close); var alsIdx=chunk.toLowerCase().indexOf(' als '); if(alsIdx>-1) chunk=chunk.slice(0,alsIdx); var parts=chunk.split(','); if(parts.length>1) chunk=parts[0]; chunk=chunk.trim(); if(lang==='de') return 'Ich wurde am '+chunk+' geboren.'; if(lang==='en') return 'I was born on '+chunk+'.'; if(lang==='fr') return 'Je suis née le '+chunk+'.'; if(lang==='pl') return 'Urodziłam się '+chunk+'.'; if(lang==='ru') return 'Я родилась '+chunk+'.'; if(lang==='ar') return 'وُلدتُ في '+chunk+'.'; if(lang==='tr') return chunk+' doğdum.'; if(lang==='ku') return 'Ez li '+chunk+' jidayik bûm.'; } }
      var sents=splitSentences(x).filter(function(s){ var low=s.toLowerCase(); return low.indexOf('gebor')>-1||low.indexOf('born')>-1||low.indexOf('née')>-1||low.indexOf('urodz')>-1||low.indexOf('родил')>-1||low.indexOf('ولدت')>-1; });
      return sents.slice(0,2).join(' ');
    }
    function extractByKeywords(extract, keys, max){ var sents=splitSentences(simplify(extract)); var out=[]; for(var i=0;i<sents.length;i++){ var s=sents[i]; var low=s.toLowerCase(); var hit=false; for(var k=0;k<keys.length;k++){ if(low.indexOf(keys[k])>-1){ hit=true; break; } } if(hit){ out.push(s); if(out.length>=(max||3)) break; } } return out.length?out.join(' '):sents.slice(0,2).join(' '); }

    async function fetchFact(lang, topic){
      var base=await fetchMoreBio(lang, 18); var q=(topic||'').toLowerCase();
      var birthK=['gebor','geburt','born','birth','née','urodz','родил','родила','ولدت'];
      var nobelK=['nobel','preis','award','prix','nagroda','نوبل'];
      var spouseK=['pierre','ehemann','husband','époux','mąż','زوج'];
      var workK=['polonium','radium','radioaktiv','radioactivity','radioactivité','promieniotwórc','radiow','радиоактив','مشع','radyoakt','polonyum','radyum'];
      var workTriggers=['erfunden','entdeck','discover','invent','découv','odkry','keşfet'];
      var childK=['tochter','irène','ève','daughter','córka','дочь','ابنة'];
      function hasAny(arr){ for(var i=0;i<arr.length;i++){ if(q.indexOf(arr[i])>-1) return true; } return false; }
      if(hasAny(birthK)) return toFirstPersonBirth(base, lang);
      if(hasAny(nobelK)) return extractByKeywords(base, nobelK, 3);
      if(hasAny(spouseK)) return extractByKeywords(base, spouseK, 3);
      if(hasAny(childK)) return extractByKeywords(base, childK, 3);
      for(var w=0;w<workTriggers.length;w++){ if(q.indexOf(workTriggers[w])>-1) return extractByKeywords(base, workK, 3); }
      for(var w2=0;w2<workK.length;w2++){ if(base.toLowerCase().indexOf(workK[w2])>-1) return extractByKeywords(base, workK, 3); }
      return splitSentences(simplify(base)).slice(0,3).join(' ');
    }

    async function botAnswer(msg){ var lang=detectLang(msg); statusEl.textContent='tippt…'; try{ var q=(msg||'').trim(); var reply=''; if(q.toLowerCase().indexOf('erkläre das genauer')>-1 || q.toLowerCase().indexOf('explain more')>-1 || q.toLowerCase().indexOf('mehr anzeigen')>-1){ reply=splitSentences(simplify(await fetchMoreBio(lang, 22))).slice(0,8).join(' '); } else if(q.toLowerCase().indexOf('wer bist du')>-1 || q.toLowerCase().indexOf('who are you')>-1){ reply=splitSentences(simplify(await fetchShortBio(lang))).slice(0,2).join(' '); } else { reply=await fetchFact(lang, q); } addBubble(reply,'bot'); } catch(e){ addBubble('Entschuldige, der Abruf war gestört. Bitte versuche es erneut.','bot'); } finally{ statusEl.textContent='online'; } }

    async function send(){ var v=inputEl.value.trim(); if(!v) return; addBubble(v,'me'); inputEl.value=''; await botAnswer(v); }
    sendBtn.addEventListener('click', send);
    inputEl.addEventListener('keydown', function(e){ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); } });

    function intro(){ personNameEl.textContent=PERSON.name; addBubble('Hallo, ich bin '+PERSON.name+', hast du eine Frage?','bot'); }
    intro();
  })();
</script>
</body>
</html>
